<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopZone - Modern E-Ticaret</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === GELİŞTİRİLMİŞ CSS === */
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #7c3aed;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius: 10px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        #app {
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* Header */
        .header {
            background: white;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo i {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1.25rem;
            padding-right: 3rem;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--light);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        .search-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: 50px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            white-space: nowrap; /* Admin linki için önemli */
        }

        .nav-link:hover {
            background: var(--light);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-menu {
            position: relative;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 250px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-top: 0.5rem;
            display: none;
            z-index: 1001;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .user-dropdown.show {
            display: block;
        }

        .user-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .user-email {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            text-decoration: none;
            color: var(--dark);
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .dropdown-item:hover {
            background: var(--light);
            color: var(--primary);
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
            border-radius: var(--radius);
            padding: 4rem 3rem;
            margin-bottom: 3rem;
            text-align: center;
            border: 1px solid rgba(79, 70, 229, 0.2);
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        /* Categories */
        .categories {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding: 1rem 0;
            -webkit-overflow-scrolling: touch;
        }

        .category-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 50px;
            background: white;
            color: var(--dark);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .category-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .category-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow);
        }

        /* Product Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--border);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .product-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: var(--transition);
            border-bottom: 1px solid var(--border);
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-content {
            padding: 1.25rem 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .product-description {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            line-height: 1.4;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px dashed var(--border); 
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--warning);
            font-size: 0.9rem;
        }

        /* Login Page and Form Elements */
        .login-container {
            max-width: 400px;
            margin: 3rem auto;
        }
        .login-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        .login-header {
             padding: 2rem;
             background: var(--light);
             border-bottom: 1px solid var(--border);
             text-align: center;
        }
        .login-body {
            padding: 2rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--light);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
            font-size: 1rem;
        }
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        .btn-danger:hover {
            background: #c93030;
            transform: translateY(-1px);
        }
        .btn-info {
            background: var(--info);
            color: white;
        }
        .btn-info:hover {
            background: #3669b3;
            transform: translateY(-1px);
        }
        .btn-success {
            background: var(--success);
            color: white;
        }
        .btn-success:hover {
            background: #0d9469;
            transform: translateY(-1px);
        }
        .btn-outline {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        .btn-block {
            width: 100%;
        }
        /* Cart Page Styles */
        .cart-container {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }
        .cart-item {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            padding: 1.5rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 1rem;
            flex-grow: 1;
        }
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: var(--radius);
            flex-shrink: 0;
        }
        .cart-item-details {
            flex-grow: 1;
        }
        .cart-item-title {
            margin: 0 0 0.25rem 0;
        }
        .cart-item-price {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.9rem;
        }
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-shrink: 0;
            width: 300px;
            justify-content: flex-end;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }
        .quantity-btn {
            background: var(--light);
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
        }
        .quantity-btn:hover {
            background: var(--border);
        }
        .quantity-value {
            padding: 0.5rem 1rem;
            font-weight: 600;
            background: white;
        }
        .cart-summary {
            width: 350px;
            padding: 1.5rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: sticky;
            top: 80px;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed var(--border);
        }
        .summary-row:last-child {
            border-bottom: none;
            font-size: 1.25rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--primary);
        }

        /* Modal Styles (Order Details / Product Admin) */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background-color: white;
            margin: auto;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 800px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--primary);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Admin Panel CSS (YENİ EKLENTİLER) */
        .admin-sidebar {
            width: 250px;
            padding: 1.5rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            flex-shrink: 0;
            border: 1px solid var(--border);
        }
        .admin-content-area {
            flex-grow: 1;
            padding-left: 2rem;
        }
        .admin-page-container {
            display: flex;
            align-items: flex-start;
        }
        .admin-nav-item {
            display: block;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
        }
        .admin-nav-item:hover {
            background: var(--light);
            color: var(--primary);
        }
        .admin-nav-item.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            border-left: 5px solid var(--primary);
        }

        .product-table, .order-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        .product-table th, .order-table th {
            text-align: left;
            padding: 1rem 1.5rem;
            background: var(--dark);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .product-table td, .order-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        .product-table tr:last-child td, .order-table tr:last-child td {
            border-bottom: none;
        }
        .product-table tr:hover, .order-table tr:hover {
            background: var(--light);
        }
        
        /* Siparişler Sayfası için */
        .order-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--secondary);
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .order-body {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            color: var(--gray);
        }
        .order-footer {
            text-align: right;
        }
        .order-status {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }
        .status-pending { background: var(--warning); }
        .status-delivered { background: var(--success); }
        .status-cancelled { background: var(--danger); }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .toast.show {
            opacity: 1;
            transform: translate(-50%, -10px);
        }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .toast.warning { background: var(--warning); }

        /* Responsive */
        @media (max-width: 1024px) {
            .admin-page-container {
                flex-direction: column;
            }
            .admin-sidebar {
                width: 100%;
                margin-bottom: 2rem;
            }
            .admin-content-area {
                padding-left: 0;
            }
            .cart-container {
                flex-direction: column;
            }
            .cart-summary {
                width: 100%;
                position: static;
            }
            .cart-item-actions {
                 width: auto;
                 flex-direction: column;
                 align-items: flex-end;
                 gap: 1rem;
            }
            .cart-item {
                flex-wrap: wrap;
            }
            .order-body {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            .search-container {
                margin: 0;
                width: 100%;
            }
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)) !important; 
                gap: 1rem;
            }
            .product-description {
                -webkit-line-clamp: 1; 
                font-size: 0.85rem;
            }
            .product-price {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 1rem;
            }
            .hero-title {
                font-size: 2rem;
            }
            .product-table th, .product-table td, .order-table th, .order-table td {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
            }
            .product-table th:nth-child(3), .product-table td:nth-child(3), 
            .order-table th:nth-child(2), .order-table td:nth-child(2) {
                display: none; /* Bazı sütunları mobilde gizle */
            }
            .cart-item-actions {
                 align-items: center;
                 width: 100%;
                 justify-content: space-between;
                 flex-direction: row;
            }
            .cart-item-image {
                width: 60px;
                height: 60px;
            }
            .cart-item-actions > div:first-child, .cart-item-actions > div:nth-child(2) {
                order: 1;
            }
            .cart-item-actions > button {
                order: 2;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <header class="header">
            <div class="container header-container">
                <a href="#home" class="logo" onclick="navigate('home')">
                    <i class="fas fa-store"></i>
                    ShopZone
                </a>
                
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Ürün ara..." id="searchInput" 
                           onkeyup="handleSearch(event)" value="">
                    <button class="search-button" onclick="performSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <nav class="nav-links">
                    <a href="#home" class="nav-link" onclick="navigate('home')">
                        <i class="fas fa-home"></i>
                        <span>Ana Sayfa</span>
                    </a>
                    
                    <a href="#cart" class="nav-link" onclick="navigate('cart')">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Sepet</span>
                        <span class="badge" id="cartBadge" style="display: none;">0</span>
                    </a>
                    
                    <div class="user-menu" id="userMenu">
                        </div>
                </nav>
            </div>
        </header>

        <main class="container main-content">
            <div id="loading" class="loading" style="text-align: center; padding: 5rem 0; display: none;">
                <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary);"></i>
                <p style="margin-top: 1rem; font-size: 1.2rem;">Yükleniyor...</p>
            </div>
            
            <div id="content">
                </div>
        </main>

        <footer style="background: var(--dark); color: white; padding: 3rem 0; margin-top: 4rem;">
            <div class="container">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                    <div>
                        <h3 style="margin-bottom: 1rem; font-size: 1.5rem;">ShopZone</h3>
                        <p style="color: #94a3b8;">Modern alışveriş deneyimi için buradayız.</p>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 1rem;">Hızlı Linkler</h4>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <a href="#home" onclick="navigate('home')" style="color: #94a3b8; text-decoration: none;">Ana Sayfa</a>
                            <a href="#cart" onclick="navigate('cart')" style="color: #94a3b8; text-decoration: none;">Sepet</a>
                        </div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 1rem;">İletişim</h4>
                        <p style="color: #94a3b8;">destek@shopzone.com</p>
                        <p style="color: #94a3b8;">+90 555 123 4567</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #334155; color: #94a3b8;">
                    <p>© 2024 ShopZone. Tüm hakları saklıdır.</p>
                </div>
            </div>
        </footer>

        <div id="toast" class="toast">
            <i class="fas fa-check-circle"></i>
            <span id="toastMessage">İşlem başarılı</span>
        </div>

        <div id="orderModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Sipariş Detayları</h3>
                    <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray);">×</button>
                </div>
                <div class="modal-body">
                    <div id="orderDetails"></div>
                </div>
            </div>
        </div>
        
        <div id="productModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3 id="productModalTitle">Yeni Ürün Ekle</h3>
                    <button onclick="closeProductModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray);">×</button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        <div class="form-group">
                            <label class="form-label">Ürün Adı</label>
                            <input type="text" id="productName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Açıklama</label>
                            <textarea id="productDescription" class="form-control" rows="3" required></textarea>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Fiyat (₺)</label>
                                <input type="number" id="productPrice" class="form-control" min="1" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stok</label>
                                <input type="number" id="productStock" class="form-control" min="0" required>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Kategori</label>
                                <select id="productCategory" class="form-control" required>
                                    <option value="Telefon">Telefon</option>
                                    <option value="Bilgisayar">Bilgisayar</option>
                                    <option value="Tablet">Tablet</option>
                                    <option value="Kulaklık">Kulaklık</option>
                                    <option value="Saat">Saat</option>
                                    <option value="Konsol">Konsol</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Görsel URL</label>
                                <input type="url" id="productImage" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Puanlama (1.0 - 5.0)</label>
                            <input type="number" id="productRating" class="form-control" min="1" max="5" step="0.1" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" id="productFormSubmitBtn">Kaydet</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============== DÜZELTİLMİŞ JAVASCRIPT KODLARI ===============
        
        // Uygulama durumu
        let appState = {
            user: null,
            cart: [],
            products: [], 
            categories: ['Tümü', 'Telefon', 'Bilgisayar', 'Tablet', 'Kulaklık', 'Saat', 'Konsol'],
            currentCategory: 'Tümü',
            orders: [],
            db: null,
            searchTerm: '',
            filteredProducts: [],
            adminActiveTab: 'dashboard' 
        };

        // IndexedDB sürümü, yeni indeks eklediğinizde bunu artırmalısınız
        const DB_VERSION = 3; 

        // =============== UTILITY FUNCTIONS ===============
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const icon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            
            toast.className = 'toast';
            toast.classList.add(type);
            
            if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle';
            } else {
                icon.className = 'fas fa-check-circle';
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0
            }).format(price);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function getOrderStatusBadge(status) {
            const statusMap = {
                pending: { text: 'Bekliyor', class: 'status-pending' },
                delivered: { text: 'Teslim Edildi', class: 'status-delivered' },
                cancelled: { text: 'İptal Edildi', class: 'status-cancelled' }
            };
            const { text, class: statusClass } = statusMap[status] || statusMap.pending;
            return `<span class="order-status ${statusClass}">${text}</span>`;
        }

        function openModal() {
            document.getElementById('orderModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('orderModal').classList.remove('show');
        }

        function openProductModal(productId = null) {
            const modal = document.getElementById('productModal');
            const title = document.getElementById('productModalTitle');
            const form = document.getElementById('productForm');
            
            form.reset();
            document.getElementById('productId').value = '';

            if (productId) {
                const product = appState.products.find(p => p.id === productId);
                if (product) {
                    title.textContent = `Ürünü Düzenle: ${product.name}`;
                    document.getElementById('productId').value = product.id;
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productStock').value = product.stock;
                    document.getElementById('productCategory').value = product.category;
                    document.getElementById('productImage').value = product.image;
                    document.getElementById('productRating').value = product.rating;
                }
            } else {
                title.textContent = 'Yeni Ürün Ekle';
            }
            modal.classList.add('show');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('show');
        }

        // =============== DATABASE OPERATIONS ===============
        
        function initDatabase() {
            return new Promise((resolve, reject) => {
                if (appState.db) {
                    resolve();
                    return;
                }
                
                const request = indexedDB.open('ShopZoneDB_v2', DB_VERSION); 
                
                request.onerror = (event) => {
                    console.error('Veritabanı açılamadı:', event.target.error);
                    reject('Veritabanı açılamadı');
                };
                
                request.onsuccess = (event) => {
                    appState.db = event.target.result;
                    console.log('✅ Veritabanı bağlantısı başarılı');
                    // Başlangıçta tüm ürünleri çek
                    dbOperation('products', 'getAll').then(products => {
                        appState.products = products;
                        resolve();
                    }).catch(reject);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Kullanıcılar (Değişiklik yok)
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'email' });
                        usersStore.createIndex('email', 'email', { unique: true });
                        
                        // Demo kullanıcılar
                        usersStore.add({
                            email: 'demo@shopzone.com',
                            password: 'demo123',
                            name: 'Demo Kullanıcı',
                            role: 'user',
                            createdAt: new Date().toISOString()
                        });
                        
                        usersStore.add({
                            email: 'admin@shopzone.com',
                            password: 'admin123',
                            name: 'Admin Kullanıcı',
                            role: 'admin',
                            createdAt: new Date().toISOString()
                        });
                    }
                    
                    // Ürünler (Değişiklik yok)
                    if (!db.objectStoreNames.contains('products')) {
                        const productsStore = db.createObjectStore('products', { keyPath: 'id', autoIncrement: true });
                        productsStore.createIndex('category', 'category', { unique: false });
                        
                        // Demo ürünler
                        const demoProducts = [
                            {
                                name: 'iPhone 15 Pro',
                                description: 'Yeni nesil iPhone profesyonel modeli',
                                price: 54999,
                                image: 'https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=400&h=300&fit=crop',
                                category: 'Telefon',
                                stock: 15,
                                rating: 4.8
                            },
                            {
                                name: 'MacBook Air M2',
                                description: 'İnce ve hafif dizüstü bilgisayar',
                                price: 35999,
                                image: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=400&h=300&fit=crop',
                                category: 'Bilgisayar',
                                stock: 8,
                                rating: 4.7
                            },
                            {
                                name: 'AirPods Pro',
                                description: 'Gelişmiş gürültü engelleme özellikli kulaklık',
                                price: 8999,
                                image: 'https://images.unsplash.com/photo-1600294037681-c80b4cb5b434?w=400&h=300&fit=crop',
                                category: 'Kulaklık',
                                stock: 25,
                                rating: 4.6
                            },
                            {
                                name: 'iPad Pro',
                                description: 'Profesyonel tablet bilgisayar',
                                price: 28999,
                                image: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400&h=300&fit=crop',
                                category: 'Tablet',
                                stock: 12,
                                rating: 4.5
                            },
                            {
                                name: 'Apple Watch Ultra',
                                description: 'Gelişmiş spor saat',
                                price: 18999,
                                image: 'https://images.unsplash.com/photo-1434493650001-5d43a6fea0a1?w=400&h=300&fit=crop',
                                category: 'Saat',
                                stock: 20,
                                rating: 4.4
                            },
                            {
                                name: 'Samsung Galaxy S23',
                                description: 'Android işletim sistemli akıllı telefon',
                                price: 32999,
                                image: 'https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=400&h=300&fit=crop',
                                category: 'Telefon',
                                stock: 18,
                                rating: 4.3
                            },
                            {
                                name: 'Microsoft Surface Pro',
                                description: '2\'si 1 arada dizüstü bilgisayar',
                                price: 42999,
                                image: 'https://images.unsplash.com/photo-1561154464-82e9adf32764?w=400&h=300&fit=crop',
                                category: 'Bilgisayar',
                                stock: 7,
                                rating: 4.2
                            },
                            {
                                name: 'Sony WH-1000XM5',
                                description: 'Wireless kulaküstü kulaklık',
                                price: 12499,
                                image: 'https://images.unsplash.com/photo-1484704849700-f032a568e944?w=400&h=300&fit=crop',
                                category: 'Kulaklık',
                                stock: 14,
                                rating: 4.7
                            },
                            {
                                name: 'PlayStation 5',
                                description: 'Yeni nesil oyun konsolu',
                                price: 18999,
                                image: 'https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?w=400&h=300&fit:crop',
                                category: 'Konsol',
                                stock: 6,
                                rating: 4.9
                            },
                            {
                                name: 'Nintendo Switch',
                                description: 'Taşınabilir oyun konsolu',
                                price: 9999,
                                image: 'https://images.unsplash.com/photo-1578303512597-81e6cc155b3e?w=400&h=300&fit:crop',
                                category: 'Konsol',
                                stock: 15,
                                rating: 4.6
                            }
                        ];
                        
                        demoProducts.forEach(product => {
                            productsStore.add(product);
                        });
                    }
                    
                    // Sepet (Değişiklik yok)
                    if (!db.objectStoreNames.contains('cart')) {
                        const cartStore = db.createObjectStore('cart', { keyPath: 'id', autoIncrement: true });
                        cartStore.createIndex('productId', 'productId', { unique: false });
                    }
                    
                    // Siparişler (userId index'i eklenmeli)
                    if (!db.objectStoreNames.contains('orders')) {
                        const ordersStore = db.createObjectStore('orders', { keyPath: 'id', autoIncrement: true });
                        ordersStore.createIndex('userId', 'userId', { unique: false }); 
                    }
                };
            });
        }
        
        function dbOperation(storeName, operation, data = null, key = null) {
            return new Promise((resolve, reject) => {
                if (!appState.db) {
                    reject('Veritabanı bağlantısı yok');
                    return;
                }
                
                const transactionType = (['get', 'getAll', 'getByIndex'].includes(operation)) ? 'readonly' : 'readwrite';
                const transaction = appState.db.transaction([storeName], transactionType);
                const store = transaction.objectStore(storeName);
                
                let request;
                
                try {
                    switch(operation) {
                        case 'getAll':
                            request = store.getAll();
                            break;
                        case 'get':
                            request = store.get(key);
                            break;
                        case 'add':
                            request = store.add(data);
                            break;
                        case 'put':
                            request = store.put(data);
                            break;
                        case 'delete':
                            request = store.delete(key);
                            break;
                        case 'clear':
                            request = store.clear();
                            break;
                        case 'getByIndex':
                            const index = store.index(data.indexName);
                            request = index.getAll(data.indexValue);
                            break;
                        default:
                            reject('Geçersiz işlem');
                            return;
                    }
                } catch(e) {
                    reject(`IndexedDB hatası: ${e.message}`);
                    return;
                }
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // =============== BUSINESS LOGIC FUNCTIONS (Sepet, Sipariş, Arama) ===============

        function scrollToProducts() {
            const categoriesDiv = document.querySelector('.categories');
            if (categoriesDiv) {
                categoriesDiv.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function filterByCategory(category) {
            appState.currentCategory = category;
            appState.searchTerm = ''; // Kategori değiştirildiğinde aramayı temizle
            document.getElementById('searchInput').value = '';
            navigate('home');
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            const input = document.getElementById('searchInput');
            appState.searchTerm = input.value.trim();
            appState.currentCategory = 'Tümü'; // Arama yapıldığında kategoriyi sıfırla
            navigate('home');
        }

        function clearSearch() {
            appState.searchTerm = '';
            document.getElementById('searchInput').value = '';
            navigate('home');
        }

        async function updateCartCount() {
            const cartItems = await dbOperation('cart', 'getAll');
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            
            const badge = document.getElementById('cartBadge');
            badge.textContent = totalItems;
            badge.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        async function addToCart(productId) {
            if (!appState.user) {
                showToast('Sepete ürün eklemek için giriş yapmalısınız', 'warning');
                navigate('login');
                return;
            }
            
            showLoading();
            try {
                const existingItem = (await dbOperation('cart', 'getAll')).find(item => item.productId === productId);
                
                const product = appState.products.find(p => p.id === productId);
                if (!product || product.stock <= 0) {
                    showToast('Ürün stokta yok veya bulunamadı!', 'error');
                    hideLoading();
                    return;
                }

                if (existingItem) {
                    // Stok kontrolü yap
                    if (existingItem.quantity + 1 > product.stock) {
                         showToast('Stok limitine ulaştınız. Daha fazla eklenemedi.', 'warning');
                         hideLoading();
                         return;
                    }
                    existingItem.quantity += 1;
                    await dbOperation('cart', 'put', existingItem);
                    showToast(`${product.name} adedi artırıldı`, 'success');
                } else {
                    const newItem = {
                        userId: appState.user.email,
                        productId: productId,
                        quantity: 1,
                        addedAt: new Date().toISOString()
                    };
                    await dbOperation('cart', 'add', newItem);
                    showToast(`${product.name} sepete eklendi`, 'success');
                }
                
                await updateCartCount();
                if (window.location.hash.slice(1) === 'home') {
                     renderHomePage(); // Stok bilgisini güncellemek için gerekebilir
                }
                
            } catch (error) {
                console.error('Sepete ekleme hatası:', error);
                showToast('Sepete eklenirken hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        async function updateCartItem(itemId, newQuantity) {
            if (newQuantity <= 0) {
                removeCartItem(itemId);
                return;
            }

            showLoading();
            try {
                const item = await dbOperation('cart', 'get', null, itemId);
                if (!item) {
                    showToast('Sepet öğesi bulunamadı', 'error');
                    return;
                }
                
                const product = appState.products.find(p => p.id === item.productId);
                if (newQuantity > product.stock) {
                     showToast(`Stok limiti: ${product.stock}. Daha fazla eklenemedi.`, 'warning');
                     return;
                }

                item.quantity = newQuantity;
                await dbOperation('cart', 'put', item);
                
                await updateCartCount();
                renderCartPage();
                
            } catch (error) {
                console.error('Sepet güncelleme hatası:', error);
                showToast('Sepet güncellenirken hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        async function removeCartItem(itemId) {
            if (!confirm('Bu ürünü sepetten kaldırmak istediğinize emin misiniz?')) return;
            
            showLoading();
            try {
                await dbOperation('cart', 'delete', null, itemId);
                await updateCartCount();
                showToast('Ürün sepetten kaldırıldı', 'success');
                renderCartPage();
            } catch (error) {
                console.error('Sepetten kaldırma hatası:', error);
                showToast('Ürün kaldırılırken hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        async function clearCart() {
            if (!confirm('Sepetinizi tamamen boşaltmak istediğinize emin misiniz?')) return;
            
            showLoading();
            try {
                await dbOperation('cart', 'clear');
                await updateCartCount();
                showToast('Sepetiniz temizlendi', 'success');
                renderCartPage();
            } catch (error) {
                console.error('Sepet temizleme hatası:', error);
                showToast('Sepet temizlenirken hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        async function completeOrder() {
            if (!appState.user) {
                showToast('Sipariş oluşturmak için giriş yapmalısınız', 'warning');
                navigate('login');
                return;
            }
            
            showLoading();

            try {
                const cartItems = await dbOperation('cart', 'getAll');
                if (cartItems.length === 0) {
                    showToast('Sepetinizde ürün yok!', 'error');
                    return;
                }
                
                let orderTotal = 0;
                const products = appState.products;
                
                // Sipariş detaylarını oluştur ve stokları düş
                const orderDetails = cartItems.map(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (!product) throw new Error(`Ürün #${item.productId} bulunamadı.`);

                    if (product.stock < item.quantity) {
                        throw new Error(`${product.name} ürününde yeterli stok yok. Stok: ${product.stock}`);
                    }

                    orderTotal += product.price * item.quantity;
                    
                    // Stok güncellemesi (IndexedDB'de anında güncelleme)
                    product.stock -= item.quantity;
                    dbOperation('products', 'put', product); 

                    return {
                        productId: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: item.quantity,
                        image: product.image
                    };
                });

                // Toplam tutar (Kargo ve vergi ekle)
                const taxRate = 0.18;
                const tax = orderTotal * taxRate;
                const shippingCost = orderTotal > 50000 ? 0 : 49.90;
                const grandTotal = orderTotal + shippingCost + tax;
                
                const newOrder = {
                    userId: appState.user.email,
                    items: orderDetails,
                    subtotal: orderTotal,
                    tax: tax,
                    shipping: shippingCost,
                    total: grandTotal,
                    status: 'pending', // Yeni sipariş 'Bekliyor' durumunda başlar
                    createdAt: new Date().toISOString()
                };
                
                await dbOperation('orders', 'add', newOrder);
                await dbOperation('cart', 'clear'); // Sepeti boşalt
                
                await updateCartCount();
                showToast('Siparişiniz başarıyla oluşturuldu! Teşekkür ederiz.', 'success');
                navigate('orders');

            } catch (error) {
                console.error('Sipariş oluşturma hatası:', error);
                showToast(`Sipariş oluşturulurken hata oluştu: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        async function viewOrderDetails(orderId) {
            showLoading();
            try {
                const order = await dbOperation('orders', 'get', null, orderId);
                if (!order) {
                    showToast('Sipariş bulunamadı', 'error');
                    return;
                }
                
                const orderDetailsDiv = document.getElementById('orderDetails');
                
                const itemsHTML = order.items.map(item => `
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; border-bottom: 1px dashed var(--border); padding-bottom: 1rem;">
                        <img src="${item.image}" style="width: 60px; height: 60px; object-fit: cover; border-radius: var(--radius);">
                        <div>
                            <strong style="font-size: 1.1rem;">${item.name}</strong>
                            <p style="color: var(--gray); margin: 0.25rem 0;">Adet: ${item.quantity} x ${formatPrice(item.price)}</p>
                            <p style="font-weight: 700; color: var(--primary);">${formatPrice(item.price * item.quantity)}</p>
                        </div>
                    </div>
                `).join('');
                
                orderDetailsDiv.innerHTML = `
                    <p><strong>Sipariş Numarası:</strong> #${order.id}</p>
                    <p><strong>Tarih:</strong> ${formatDate(order.createdAt)}</p>
                    <p><strong>Kullanıcı:</strong> ${order.userId}</p>
                    <p style="margin-bottom: 1rem;"><strong>Durum:</strong> ${getOrderStatusBadge(order.status)}</p>
                    
                    <h4 style="margin-top: 1rem; border-bottom: 2px solid var(--border); padding-bottom: 0.5rem;">Ürünler</h4>
                    ${itemsHTML}
                    
                    <h4 style="margin-top: 1rem; border-bottom: 2px solid var(--border); padding-bottom: 0.5rem;">Özet</h4>
                    <div style="padding: 1rem; background: var(--light); border-radius: var(--radius);">
                        <div style="display: flex; justify-content: space-between;"><span>Ara Toplam:</span> <span>${formatPrice(order.subtotal)}</span></div>
                        <div style="display: flex; justify-content: space-between;"><span>Kargo:</span> <span>${order.shipping === 0 ? 'Ücretsiz' : formatPrice(order.shipping)}</span></div>
                        <div style="display: flex; justify-content: space-between;"><span>Vergi:</span> <span>${formatPrice(order.tax)}</span></div>
                        <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem; margin-top: 0.5rem; border-top: 1px solid var(--border); padding-top: 0.5rem;">
                            <span>Toplam:</span> <span>${formatPrice(order.total)}</span>
                        </div>
                    </div>
                `;
                openModal();
            } catch (error) {
                console.error('Sipariş detayları hatası:', error);
                showToast('Sipariş detayları yüklenirken hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        // =============== AUTH FUNCTIONS ===============
        
        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function checkAuth() {
            const userData = localStorage.getItem('shopzone_user');
            if (userData) {
                appState.user = JSON.parse(userData);
                updateUserSection();
                return true;
            }
            return false;
        }

        async function login(email, password) {
             try {
                showLoading();
                const user = await dbOperation('users', 'get', null, email);
                if (!user || user.password !== password) {
                    showToast('E-posta veya şifre hatalı', 'error');
                    hideLoading();
                    return false;
                }
                
                const { password: _, ...userWithoutPassword } = user;
                appState.user = userWithoutPassword;
                localStorage.setItem('shopzone_user', JSON.stringify(userWithoutPassword));
                
                updateUserSection();
                showToast(`Hoş geldiniz, ${user.name}!`);
                hideLoading();
                return true;
                
            } catch (error) {
                console.error('Giriş hatası:', error);
                showToast('Giriş sırasında hata oluştu', 'error');
                hideLoading();
                return false;
            }
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Lütfen tüm alanları doldurun', 'error');
                return;
            }
            
            const success = await login(email, password);
            if (success) {
                navigate('home');
            }
        }

        function logout() {
            if (confirm('Çıkış yapmak istediğinize emin misiniz?')) {
                appState.user = null;
                localStorage.removeItem('shopzone_user');
                updateUserSection();
                showToast('Başarıyla çıkış yapıldı');
                navigate('home');
            }
        }
        
        function showRegisterForm() {
            const form = document.getElementById('registerForm');
            form.style.display = form.style.display === 'block' ? 'none' : 'block';
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            if (!name || !email || !password) {
                showToast('Lütfen tüm alanları doldurun', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('Şifre en az 6 karakter olmalıdır', 'error');
                return;
            }

            try {
                showLoading();
                // E-posta kontrolü
                const existingUser = await dbOperation('users', 'get', null, email);
                if (existingUser) {
                    showToast('Bu e-posta adresi zaten kayıtlı', 'error');
                    hideLoading();
                    return;
                }

                const newUser = {
                    email,
                    password, 
                    name,
                    role: 'user', 
                    createdAt: new Date().toISOString()
                };

                await dbOperation('users', 'add', newUser);

                showToast('Kayıt başarılı! Lütfen giriş yapın.', 'success');
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('loginEmail').value = email;
                document.getElementById('loginPassword').value = password;

            } catch (error) {
                console.error('Kayıt hatası:', error);
                showToast('Kayıt sırasında bir hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        function updateUserSection() {
            const userMenu = document.getElementById('userMenu');
            
            if (appState.user) {
                const adminLink = appState.user.role === 'admin' ? `
                    <a href="#admin" class="dropdown-item" onclick="navigate('admin')">
                        <i class="fas fa-tools"></i>
                        <span>Admin Paneli</span>
                    </a>
                ` : '';

                userMenu.innerHTML = `
                    <button class="nav-link" onclick="toggleUserDropdown()">
                        <i class="fas fa-user"></i>
                        <span>${appState.user.name.split(' ')[0]}</span>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-header">
                            <div class="user-name">${appState.user.name}</div>
                            <div class="user-email">${appState.user.email}</div>
                        </div>
                        <a href="#" class="dropdown-item" onclick="navigate('profile')">
                            <i class="fas fa-user-circle"></i>
                            <span>Profilim</span>
                        </a>
                        <a href="#" class="dropdown-item" onclick="navigate('orders')">
                            <i class="fas fa-history"></i>
                            <span>Siparişlerim</span>
                        </a>
                        ${adminLink}
                        <a href="#" class="dropdown-item" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Çıkış Yap</span>
                        </a>
                    </div>
                `;
            } else {
                userMenu.innerHTML = `
                    <a href="#login" class="nav-link" onclick="navigate('login')">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Giriş Yap</span>
                    </a>
                `;
            }
        }

        // =============== ADMIN MANAGEMENT FUNCTIONS ===============

        function setAdminTab(tab) {
            appState.adminActiveTab = tab;
            renderAdminPage(false); // Sayfayı tamamen yenileme
        }

        // Ürün Ekle/Düzenle
        async function handleProductSubmit(event) {
            event.preventDefault();
            
            closeProductModal();
            showLoading();

            const productId = document.getElementById('productId').value;
            const isEditing = !!productId;
            
            const productData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                category: document.getElementById('productCategory').value,
                image: document.getElementById('productImage').value,
                rating: parseFloat(document.getElementById('productRating').value)
            };
            
            if (productData.rating < 1 || productData.rating > 5) {
                showToast('Puanlama 1.0 ile 5.0 arasında olmalıdır.', 'error');
                hideLoading();
                return;
            }

            if (isEditing) {
                productData.id = parseInt(productId);
            }

            try {
                if (isEditing) {
                    await dbOperation('products', 'put', productData);
                    // Belleği güncelle
                    const index = appState.products.findIndex(p => p.id === productData.id);
                    if (index > -1) {
                        appState.products[index] = productData;
                    }
                    showToast('Ürün başarıyla güncellendi', 'success');
                } else {
                    const result = await dbOperation('products', 'add', productData);
                    productData.id = result; // Otomatik artan ID'yi al
                    appState.products.push(productData);
                    showToast('Yeni ürün başarıyla eklendi', 'success');
                }
                
                renderAdminPage(false); // Sadece Admin sayfasını tekrar render et
                
            } catch (error) {
                console.error('Ürün işlemi hatası:', error);
                showToast(`Ürün ${isEditing ? 'güncellenirken' : 'eklenirken'} hata oluştu: ${error.message}`, 'error');
                hideLoading();
            }
        }

        // Ürün Sil
        async function deleteProduct(productId) {
            if (!confirm('Bu ürünü kalıcı olarak silmek istediğinizden emin misiniz?')) return;

            showLoading();
            try {
                await dbOperation('products', 'delete', null, productId);
                
                // Belleği güncelle
                appState.products = appState.products.filter(p => p.id !== productId);
                
                showToast('Ürün başarıyla silindi', 'success');
                renderAdminPage(false);
                
            } catch (error) {
                console.error('Ürün silme hatası:', error);
                showToast('Ürün silinirken hata oluştu', 'error');
                hideLoading();
            }
        }
        
        // Sipariş Durumu Güncelle
        async function updateOrderStatus(orderId, newStatus) {
            showLoading();
            try {
                const order = await dbOperation('orders', 'get', null, orderId);
                if (!order) {
                    showToast('Sipariş bulunamadı', 'error');
                    hideLoading();
                    return;
                }
                
                order.status = newStatus;
                await dbOperation('orders', 'put', order);
                
                // Belleği güncelle
                const index = appState.orders.findIndex(o => o.id === orderId);
                if (index > -1) {
                    appState.orders[index].status = newStatus;
                }
                
                showToast(`Sipariş #${orderId} durumu güncellendi: ${newStatus}`, 'success');
                renderAdminPage(false);
                
            } catch (error) {
                console.error('Sipariş durumu güncelleme hatası:', error);
                showToast('Sipariş durumu güncellenirken hata oluştu', 'error');
                hideLoading();
            }
        }
        
        // =============== ADMIN PAGE RENDERING FUNCTIONS ===============

        async function renderAdminDashboard() {
            // Tüm verileri çek
            const allProducts = appState.products;
            const allOrders = await dbOperation('orders', 'getAll');
            const allUsers = await dbOperation('users', 'getAll');
            
            const totalProducts = allProducts.length;
            const totalOrders = allOrders.length;
            const totalUsers = allUsers.length;
            const totalRevenue = allOrders.reduce((sum, order) => sum + order.total, 0);
            const pendingOrders = allOrders.filter(o => o.status === 'pending').length;
            
            return `
                <h2 style="margin-bottom: 2rem; font-size: 2rem;">Admin Kontrol Paneli</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                    <div class="stat-card" style="border-left-color: var(--primary);">
                        <div style="font-size: 0.9rem; color: var(--gray);">Toplam Ciro</div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--primary);">${formatPrice(totalRevenue)}</div>
                    </div>
                    <div class="stat-card" style="border-left-color: var(--info);">
                        <div style="font-size: 0.9rem; color: var(--gray);">Toplam Sipariş</div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--info);">${totalOrders}</div>
                    </div>
                    <div class="stat-card" style="border-left-color: var(--danger);">
                        <div style="font-size: 0.9rem; color: var(--gray);">Bekleyen Sipariş</div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--danger);">${pendingOrders}</div>
                    </div>
                    <div class="stat-card" style="border-left-color: var(--success);">
                        <div style="font-size: 0.9rem; color: var(--gray);">Ürün Sayısı</div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: var(--success);">${totalProducts}</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 3rem; margin-bottom: 1.5rem;">Son Kullanıcılar (${totalUsers})</h3>
                <div style="background: white; padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm);">
                    <p style="color: var(--gray);">Kullanıcı yönetimi için ayrı bir sekme tasarlanabilir. Şimdilik istatistiksel bilgi.</p>
                </div>
            `;
        }

        async function renderAdminProducts() {
            const allProducts = appState.products.sort((a, b) => a.id - b.id);
            
            const productTableHTML = `
                <table class="product-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ürün Adı</th>
                            <th>Kategori</th>
                            <th>Fiyat</th>
                            <th>Stok</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allProducts.map(p => `
                            <tr>
                                <td>#${p.id}</td>
                                <td style="font-weight: 600;">${p.name}</td>
                                <td>${p.category}</td>
                                <td>${formatPrice(p.price)}</td>
                                <td><span style="font-weight: 600; color: ${p.stock < 10 ? 'var(--danger)' : 'var(--success)'};">${p.stock}</span></td>
                                <td>
                                    <button class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.8rem;" 
                                            onclick="openProductModal(${p.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.8rem;" 
                                            onclick="deleteProduct(${p.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            return `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="font-size: 2rem;">Ürün Yönetimi (${allProducts.length})</h2>
                    <button class="btn btn-primary" onclick="openProductModal()">
                        <i class="fas fa-plus"></i> Yeni Ürün Ekle
                    </button>
                </div>
                ${allProducts.length > 0 ? productTableHTML : `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h3>Henüz ürün bulunmuyor</h3>
                    </div>
                `}
            `;
        }

        async function renderAdminOrders() {
            const allOrders = await dbOperation('orders', 'getAll');
            const sortedOrders = allOrders.sort((a, b) => b.id - a.id); // Yeniden eskiye
            
            appState.orders = sortedOrders;

            const orderTableHTML = `
                <table class="order-table">
                    <thead>
                        <tr>
                            <th>Sipariş No</th>
                            <th>Tarih</th>
                            <th>Kullanıcı</th>
                            <th>Toplam Tutar</th>
                            <th>Durum</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sortedOrders.map(o => `
                            <tr>
                                <td>#${o.id}</td>
                                <td>${formatDate(o.createdAt).split(',')[0]}</td>
                                <td>${o.userId}</td>
                                <td><strong style="color: var(--primary);">${formatPrice(o.total)}</strong></td>
                                <td>${getOrderStatusBadge(o.status)}</td>
                                <td>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-info" style="padding: 0.5rem 1rem; font-size: 0.8rem;" 
                                                onclick="viewOrderDetails(${o.id})">
                                            <i class="fas fa-eye"></i> Detay
                                        </button>
                                        <select onchange="updateOrderStatus(${o.id}, this.value)" class="form-control" style="width: 120px; padding: 0.5rem; font-size: 0.8rem;">
                                            <option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Bekliyor</option>
                                            <option value="delivered" ${o.status === 'delivered' ? 'selected' : ''}>Teslim Edildi</option>
                                            <option value="cancelled" ${o.status === 'cancelled' ? 'selected' : ''}>İptal Edildi</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            return `
                <h2 style="margin-bottom: 2rem; font-size: 2rem;">Sipariş Yönetimi (${sortedOrders.length})</h2>
                ${sortedOrders.length > 0 ? orderTableHTML : `
                    <div class="empty-state">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Henüz sipariş bulunmuyor</h3>
                    </div>
                `}
            `;
        }
        
        // Ana Admin Sayfası Yönlendiricisi
        async function renderAdminPage(fetchData = true) {
            if (!appState.user || appState.user.role !== 'admin') {
                showToast('Bu sayfaya erişim yetkiniz yok', 'error');
                navigate('home');
                return;
            }
            
            showLoading();

            try {
                // Sadece ilk yüklemede verileri çek
                if (fetchData) {
                    // Tüm siparişleri önbelleğe çekmek, istatistikler ve sipariş yönetimi için önemli
                    appState.orders = await dbOperation('orders', 'getAll'); 
                }

                let contentHTML = '';
                
                switch(appState.adminActiveTab) {
                    case 'dashboard':
                        contentHTML = await renderAdminDashboard();
                        break;
                    case 'products':
                        contentHTML = await renderAdminProducts();
                        break;
                    case 'orders':
                        contentHTML = await renderAdminOrders();
                        break;
                    default:
                        contentHTML = await renderAdminDashboard();
                }

                document.getElementById('content').innerHTML = `
                    <div style="margin-bottom: 2rem;">
                        <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Admin Paneli</h1>
                        <p style="color: var(--gray);">Sistem genelini yönetin</p>
                    </div>
                    
                    <div class="admin-page-container">
                        <div class="admin-sidebar">
                            <h3 style="margin-bottom: 1rem; color: var(--primary);">Menü</h3>
                            <a href="#" class="admin-nav-item ${appState.adminActiveTab === 'dashboard' ? 'active' : ''}" 
                               onclick="setAdminTab('dashboard')">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                            <a href="#" class="admin-nav-item ${appState.adminActiveTab === 'products' ? 'active' : ''}" 
                               onclick="setAdminTab('products')">
                                <i class="fas fa-boxes"></i> Ürünler
                            </a>
                            <a href="#" class="admin-nav-item ${appState.adminActiveTab === 'orders' ? 'active' : ''}" 
                               onclick="setAdminTab('orders')">
                                <i class="fas fa-clipboard-list"></i> Siparişler
                            </a>
                        </div>
                        <div class="admin-content-area">
                            ${contentHTML}
                        </div>
                    </div>
                `;

                // Ürün modalı submit listener'ı (Tekrar eklenmeli)
                const productForm = document.getElementById('productForm');
                if (productForm) {
                    productForm.onsubmit = handleProductSubmit;
                }
                
                hideLoading();

            } catch(error) {
                console.error('Admin sayfası yüklenirken hata:', error);
                document.getElementById('content').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Admin sayfası yüklenirken hata oluştu</h3>
                        <p>Lütfen tekrar deneyin. Detay: ${error.message}</p>
                    </div>
                `;
                hideLoading();
            }
        }
        
        // =============== PAGE RENDER FUNCTIONS ===============

        async function renderHomePage() { 
            showLoading();
            
            try {
                // Ürünleri bellekteki listeden al
                const products = appState.products;
                
                let productsHTML = '';
                
                let filteredProducts = products;
                
                // 1. Arama terimi varsa filtrele
                if (appState.searchTerm) {
                    const searchTermLower = appState.searchTerm.toLowerCase();
                    filteredProducts = products.filter(product => {
                        return (
                            product.name.toLowerCase().includes(searchTermLower) ||
                            product.description.toLowerCase().includes(searchTermLower) ||
                            product.category.toLowerCase().includes(searchTermLower)
                        );
                    });
                }
                
                // 2. Kategoriye göre filtrele
                if (appState.currentCategory !== 'Tümü') {
                    filteredProducts = filteredProducts.filter(p => p.category === appState.currentCategory);
                }
                
                if (filteredProducts.length === 0) {
                    if (appState.searchTerm) {
                         productsHTML = `
                            <div class="empty-state">
                                <i class="fas fa-search"></i>
                                <h3>Arama sonucu bulunamadı</h3>
                                <p>"${appState.searchTerm}" için ürün bulunamadı</p>
                                <button class="btn btn-primary" onclick="clearSearch()">
                                    <i class="fas fa-times"></i>
                                    Aramayı Temizle
                                </button>
                            </div>
                        `;
                    } else {
                         productsHTML = `
                            <div class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <h3>Bu kategoride ürün bulunmuyor</h3>
                                <p>Diğer kategorileri deneyebilirsiniz</p>
                            </div>
                        `;
                    }
                } else {
                    productsHTML = filteredProducts.map(product => `
                        <div class="product-card">
                            ${product.stock < 5 ? `<div class="product-badge">Son ${product.stock} Ürün</div>` : ''}
                            <img src="${product.image}" alt="${product.name}" class="product-image">
                            <div class="product-content">
                                <h3 class="product-title">${product.name}</h3>
                                <p class="product-description">${product.description}</p>
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                    <div class="product-rating">
                                        ${Array(5).fill().map((_, i) => `
                                            <i class="fas fa-star${i < Math.floor(product.rating) ? '' : (i < product.rating ? '-half-alt' : '')}"></i>
                                        `).join('')}
                                        <span style="color: var(--gray); margin-left: 0.5rem;">(${product.rating})</span>
                                    </div>
                                    <div style="color: var(--gray); font-size: 0.9rem;">
                                        Stok: ${product.stock}
                                    </div>
                                </div>
                                <div class="product-footer">
                                    <div class="product-price">${formatPrice(product.price)}</div>
                                    <button class="btn btn-primary" ${product.stock > 0 ? `onclick="addToCart(${product.id})"` : 'disabled'} style="${product.stock === 0 ? 'background: var(--gray); cursor: not-allowed;' : ''}">
                                        <i class="fas fa-cart-plus"></i>
                                        ${product.stock > 0 ? 'Sepete Ekle' : 'Stokta Yok'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                
                const categoriesHTML = appState.categories.map(category => `
                    <button class="category-btn ${category === appState.currentCategory ? 'active' : ''}" 
                            onclick="filterByCategory('${category}')">
                        ${category}
                    </button>
                `).join('');
                
                const searchInfo = appState.searchTerm ? 
                    `<div style="margin-bottom: 1.5rem; padding: 1rem; background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1)); border-radius: var(--radius);">
                        <strong>Arama:</strong> "${appState.searchTerm}" - ${filteredProducts.length} sonuç bulundu
                        <button class="btn btn-sm" onclick="clearSearch()" style="margin-left: 1rem; padding: 0.25rem 0.75rem; font-size: 0.875rem;">
                            <i class="fas fa-times"></i> Temizle
                        </button>
                    </div>` : '';
                
                document.getElementById('content').innerHTML = `
                    <div class="hero-section">
                        <h1 class="hero-title">En İyi Teknoloji Ürünleri</h1>
                        <p class="hero-subtitle">Modern hayatınızı kolaylaştıracak en son teknoloji ürünlerini keşfedin</p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-primary" onclick="navigate('cart')">
                                <i class="fas fa-shopping-cart"></i>
                                Sepete Git
                            </button>
                            <button class="btn btn-outline" onclick="scrollToProducts()">
                                <i class="fas fa-arrow-down"></i>
                                Ürünleri Keşfet
                            </button>
                        </div>
                    </div>
                    
                    ${searchInfo}
                    
                    <div style="margin-bottom: 3rem;">
                        <h2 style="margin-bottom: 1.5rem;">Kategoriler</h2>
                        <div class="categories">
                            ${categoriesHTML}
                        </div>
                    </div>
                    
                    <div>
                        <h2 style="margin-bottom: 1.5rem;">
                            ${appState.currentCategory === 'Tümü' ? 'Tüm Ürünler' : appState.currentCategory} 
                            (${filteredProducts.length})
                        </h2>
                        <div class="products-grid">
                            ${productsHTML}
                        </div>
                    </div>
                `;
                
                hideLoading();
                
            } catch (error) {
                console.error('Ana sayfa yüklenirken hata:', error);
                document.getElementById('content').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Sayfa yüklenirken hata oluştu</h3>
                        <button class="btn btn-primary" onclick="renderHomePage()">
                            Tekrar Dene
                        </button>
                    </div>
                `;
                hideLoading();
            }
        }
        
        async function renderCartPage() { 
            if (!appState.user) {
                showToast('Sepeti görüntülemek için giriş yapmalısınız', 'error');
                navigate('login');
                return;
            }
            
            showLoading();
            
            try {
                const cartItems = await dbOperation('cart', 'getAll');
                const products = appState.products; 
                
                let cartHTML = '';
                let totalPrice = 0;
                let totalItems = 0;
                
                const cartDetails = cartItems.map(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (!product) return null;
                    
                    const itemTotal = product.price * item.quantity;
                    totalPrice += itemTotal;
                    totalItems += item.quantity;
                    
                    return {
                        ...item,
                        product,
                        itemTotal
                    };
                }).filter(item => item !== null);

                
                if (cartDetails.length === 0) {
                    cartHTML = `
                        <div class="empty-state" style="text-align: center; padding: 5rem 0; border: 1px dashed var(--border); border-radius: var(--radius);">
                            <i class="fas fa-shopping-cart" style="font-size: 3rem; color: var(--gray); margin-bottom: 1rem;"></i>
                            <h3>Sepetiniz Boş</h3>
                            <p>Alışverişe başlamak için ürün ekleyin</p>
                            <button class="btn btn-primary" style="margin-top: 1.5rem;" onclick="navigate('home')">
                                <i class="fas fa-store"></i>
                                Alışverişe Devam Et
                            </button>
                        </div>
                    `;
                    document.getElementById('content').innerHTML = `
                        <div style="margin-bottom: 2rem;">
                            <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Sepetim</h1>
                            <p style="color: var(--gray);">0 ürün, 0 adet</p>
                        </div>
                        <div class="cart-container">
                            ${cartHTML}
                        </div>
                    `;
                } else {
                    let itemsHTML = '';
                    for (const item of cartDetails) {
                        itemsHTML += `
                            <div class="cart-item">
                                <img src="${item.product.image}" alt="${item.product.name}" class="cart-item-image">
                                <div class="cart-item-details">
                                    <h4 class="cart-item-title">${item.product.name}</h4>
                                    <p class="product-description">${item.product.description}</p>
                                    <div class="cart-item-price">${formatPrice(item.product.price)}</div>
                                </div>
                                <div class="cart-item-actions">
                                    <div class="quantity-control">
                                        <button class="quantity-btn" onclick="updateCartItem(${item.id}, ${item.quantity - 1})">-</button>
                                        <span class="quantity-value">${item.quantity}</span>
                                        <button class="quantity-btn" onclick="updateCartItem(${item.id}, ${item.quantity + 1})">+</button>
                                    </div>
                                    <div style="font-weight: 700; font-size: 1.25rem;">${formatPrice(item.itemTotal)}</div>
                                    <button class="btn btn-danger" onclick="removeCartItem(${item.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                    
                    const taxRate = 0.18;
                    const tax = totalPrice * taxRate;
                    const shippingCost = totalPrice > 50000 ? 0 : 49.90;
                    const grandTotal = totalPrice + shippingCost + tax;
                    
                    const summaryHTML = `
                        <div class="cart-summary">
                            <h3 style="margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">Sipariş Özeti</h3>
                            <div class="summary-row">
                                <span>Ürünler (${totalItems} adet)</span>
                                <span>${formatPrice(totalPrice)}</span>
                            </div>
                            <div class="summary-row">
                                <span>Kargo</span>
                                <span style="font-weight: 600; color: ${shippingCost === 0 ? 'var(--success)' : 'var(--dark)'};">${shippingCost === 0 ? 'Ücretsiz' : formatPrice(shippingCost)}</span>
                            </div>
                            <div class="summary-row">
                                <span>Vergiler (%${(taxRate * 100).toFixed(0)})</span>
                                <span>${formatPrice(tax)}</span>
                            </div>
                            <div class="summary-row">
                                <strong>Toplam</strong>
                                <strong style="color: var(--primary);">${formatPrice(grandTotal)}</strong>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 2rem;">
                                <button class="btn btn-primary" onclick="completeOrder()">
                                    <i class="fas fa-credit-card"></i>
                                    Ödeme Yap
                                </button>
                                <button class="btn btn-outline" onclick="clearCart()" style="border-color: var(--danger); color: var(--danger);">
                                    <i class="fas fa-trash"></i>
                                    Sepeti Temizle
                                </button>
                            </div>
                        </div>
                    `;

                    document.getElementById('content').innerHTML = `
                        <div style="margin-bottom: 2rem;">
                            <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Sepetim</h1>
                            <p style="color: var(--gray);">${cartDetails.length} ürün, ${totalItems} adet</p>
                        </div>
                        <div class="cart-container">
                            <div style="flex-grow: 1;">${itemsHTML}</div>
                            ${summaryHTML}
                        </div>
                    `;
                }
                
                hideLoading();
                
            } catch (error) {
                console.error('Sepet yüklenirken hata:', error);
                document.getElementById('content').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Sepet yüklenirken hata oluştu</h3>
                        <button class="btn btn-primary" onclick="renderCartPage()">
                            Tekrar Dene
                        </button>
                    </div>
                `;
                hideLoading();
            }
        }
        
        async function renderLoginPage() { 
             document.getElementById('content').innerHTML = `
                <div class="login-container">
                    <div class="login-card">
                        <div class="login-header">
                            <h2 style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--primary);">Hoş Geldiniz</h2>
                            <p style="color: var(--gray);">Hesabınıza giriş yapın veya yeni hesap oluşturun</p>
                        </div>
                        <div class="login-body">
                            <div class="form-group">
                                <label class="form-label">E-posta</label>
                                <input type="email" id="loginEmail" class="form-control" placeholder="ornek@email.com" value="demo@shopzone.com">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Şifre</label>
                                <input type="password" id="loginPassword" class="form-control" placeholder="Şifreniz" value="demo123">
                            </div>
                            
                            <button class="btn btn-primary btn-block" onclick="handleLogin()">
                                <i class="fas fa-sign-in-alt"></i>
                                Giriş Yap
                            </button>
                            
                            <div style="text-align: center; margin: 2rem 0;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div style="flex: 1; height: 1px; background: var(--border);"></div>
                                    <span style="color: var(--gray);">veya</span>
                                    <div style="flex: 1; height: 1px; background: var(--border);"></div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <button class="btn btn-outline btn-block" onclick="showRegisterForm()">
                                    <i class="fas fa-user-plus"></i>
                                    Yeni Hesap Oluştur
                                </button>
                            </div>
                            
                            <div id="registerForm" style="display: none; border-top: 1px solid var(--border); padding-top: 1.5rem;">
                                <h3 style="margin-bottom: 1.5rem;">Yeni Hesap</h3>
                                
                                <div class="form-group">
                                    <label class="form-label">Ad Soyad</label>
                                    <input type="text" id="registerName" class="form-control" placeholder="Adınız Soyadınız">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">E-posta</label>
                                    <input type="email" id="registerEmail" class="form-control" placeholder="ornek@email.com">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Şifre</label>
                                    <input type="password" id="registerPassword" class="form-control" placeholder="Şifreniz (en az 6 karakter)">
                                </div>
                                
                                <button class="btn btn-success btn-block" onclick="register()">
                                    <i class="fas fa-user-plus"></i>
                                    Kayıt Ol
                                </button>
                            </div>
                            
                            <div style="margin-top: 2rem; padding: 1rem; background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1)); border-radius: var(--radius);">
                                <p style="margin: 0; font-size: 0.9rem; text-align: center;">
                                    <strong>Demo Hesaplar:</strong><br>
                                    Kullanıcı: demo@shopzone.com / demo123<br>
                                    Admin: admin@shopzone.com / admin123
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            hideLoading();
        }

        async function renderOrdersPage() {
            if (!appState.user) {
                showToast('Siparişlerinizi görmek için giriş yapmalısınız', 'error');
                navigate('login');
                return;
            }
            
            showLoading();
            try {
                const userOrders = await dbOperation('orders', 'getByIndex', { 
                    indexName: 'userId', 
                    indexValue: appState.user.email 
                });
                
                const sortedOrders = userOrders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                let ordersHTML = '';
                
                if (sortedOrders.length === 0) {
                    ordersHTML = `
                        <div class="empty-state" style="text-align: center; padding: 5rem 0; border: 1px dashed var(--border); border-radius: var(--radius);">
                            <i class="fas fa-history" style="font-size: 3rem; color: var(--gray); margin-bottom: 1rem;"></i>
                            <h3>Henüz siparişiniz bulunmuyor</h3>
                            <p>Alışverişe başlayın ve ilk siparişinizi verin!</p>
                            <button class="btn btn-primary" style="margin-top: 1.5rem;" onclick="navigate('home')">
                                <i class="fas fa-store"></i>
                                Alışverişe Başla
                            </button>
                        </div>
                    `;
                } else {
                    ordersHTML = sortedOrders.map(order => `
                        <div class="order-card">
                            <div class="order-header">
                                <div style="font-size: 1.25rem; font-weight: 600;">Sipariş #${order.id}</div>
                                ${getOrderStatusBadge(order.status)}
                            </div>
                            <div class="order-body">
                                <p><strong>Tarih:</strong> ${formatDate(order.createdAt).split(',')[0]}</p>
                                <p><strong>Toplam:</strong> <strong style="color: var(--primary);">${formatPrice(order.total)}</strong></p>
                                <p><strong>Ürün Adedi:</strong> ${order.items.reduce((sum, item) => sum + item.quantity, 0)}</p>
                            </div>
                            <div class="order-footer">
                                <button class="btn btn-info" style="padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="viewOrderDetails(${order.id})">
                                    <i class="fas fa-eye"></i> Detayları Gör
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
                
                document.getElementById('content').innerHTML = `
                    <h1 style="font-size: 2.5rem; margin-bottom: 2rem;">Siparişlerim</h1>
                    <div class="orders-list">
                        ${ordersHTML}
                    </div>
                `;
                
            } catch (error) {
                console.error('Siparişler yüklenirken hata:', error);
                showToast('Siparişleriniz yüklenirken bir hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        async function renderProfilePage() {
            if (!appState.user) {
                showToast('Profilinizi görmek için giriş yapmalısınız', 'error');
                navigate('login');
                return;
            }
            
            showLoading();
            try {
                const user = appState.user;
                const totalOrders = await dbOperation('orders', 'getByIndex', { 
                    indexName: 'userId', 
                    indexValue: user.email 
                });
                
                document.getElementById('content').innerHTML = `
                    <div style="max-width: 600px; margin: 0 auto; background: white; padding: 2.5rem; border-radius: var(--radius); box-shadow: var(--shadow-lg);">
                        <h1 style="font-size: 2.5rem; margin-bottom: 2rem; text-align: center;">Profilim</h1>
                        
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <i class="fas fa-user-circle" style="font-size: 4rem; color: var(--primary);"></i>
                            <h2 style="margin-top: 1rem;">${user.name}</h2>
                            <p style="color: var(--gray);">${user.email}</p>
                        </div>
                        
                        <div style="border-top: 1px solid var(--border); padding-top: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
                            <p style="font-size: 1.1rem; padding: 0.75rem 0; border-bottom: 1px dashed var(--border);">
                                <strong>Rol:</strong> 
                                <span style="font-weight: 600; color: ${user.role === 'admin' ? 'var(--danger)' : 'var(--success)'};">
                                    ${user.role.toUpperCase()}
                                </span>
                            </p>
                            <p style="font-size: 1.1rem; padding: 0.75rem 0; border-bottom: 1px dashed var(--border);">
                                <strong>Üyelik Tarihi:</strong> ${formatDate(user.createdAt)}
                            </p>
                            <p style="font-size: 1.1rem; padding: 0.75rem 0; border-bottom: 1px dashed var(--border);">
                                <strong>Toplam Sipariş:</strong> <strong style="color: var(--info);">${totalOrders.length}</strong>
                            </p>
                        </div>
                        
                        <div style="margin-top: 2rem; display: flex; justify-content: space-between;">
                            <button class="btn btn-outline" onclick="navigate('orders')">
                                <i class="fas fa-history"></i> Siparişlerimi Gör
                            </button>
                            <button class="btn btn-danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Çıkış Yap
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Profil yüklenirken hata:', error);
                showToast('Profiliniz yüklenirken bir hata oluştu', 'error');
            } finally {
                hideLoading();
            }
        }

        // =============== NAVIGATION ===============
        
        function navigate(page) {
            window.location.hash = page;
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLink = document.querySelector(`.nav-links a[href="#${page}"]`);
            if (navLink) {
                navLink.classList.add('active');
            }
            
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            switch(page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'login':
                    renderLoginPage();
                    break;
                case 'cart':
                    renderCartPage();
                    break;
                case 'orders':
                    renderOrdersPage();
                    break;
                case 'profile':
                    renderProfilePage();
                    break;
                case 'admin': 
                    renderAdminPage();
                    break;
                default:
                    renderHomePage();
            }
        }
        
        // =============== INITIALIZATION ===============
        
        async function initApp() {
            try {
                console.log('🚀 ShopZone Pro başlatılıyor...');
                showLoading();
                
                await initDatabase();
                checkAuth();
                await updateCartCount();
                
                window.addEventListener('hashchange', () => {
                    const page = window.location.hash.slice(1) || 'home';
                    navigate(page);
                });
                
                document.getElementById('searchInput')?.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
                
                document.getElementById('orderModal')?.addEventListener('click', (e) => {
                    if (e.target === document.getElementById('orderModal')) {
                        closeModal();
                    }
                });
                
                document.getElementById('productModal')?.addEventListener('click', (e) => {
                    if (e.target === document.getElementById('productModal')) {
                        closeProductModal();
                    }
                });
                
                const productForm = document.getElementById('productForm');
                if (productForm) {
                    productForm.onsubmit = handleProductSubmit;
                }
                
                const initialPage = window.location.hash.slice(1) || 'home';
                navigate(initialPage);
                
                console.log('✅ ShopZone Pro başarıyla başlatıldı');
                
            } catch (error) {
                console.error('❌ Uygulama başlatılırken hata:', error);
                document.getElementById('content').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Uygulama başlatılırken hata oluştu</h3>
                        <p>Lütfen sayfayı yenileyin veya internet bağlantınızı kontrol edin</p>
                        <button class="btn btn-primary" onclick="location.reload()">
                            <i class="fas fa-redo"></i>
                            Sayfayı Yenile
                        </button>
                    </div>
                `;
                hideLoading();
            }
        }

        // Global fonksiyonlar (Tüm fonksiyonların erişilebilir olması sağlandı)
        window.navigate = navigate;
        window.addToCart = addToCart;
        window.updateCartItem = updateCartItem;
        window.removeCartItem = removeCartItem;
        window.filterByCategory = filterByCategory;
        window.scrollToProducts = scrollToProducts;
        window.handleLogin = handleLogin;
        window.register = register;
        window.showRegisterForm = showRegisterForm;
        window.completeOrder = completeOrder;
        window.clearCart = clearCart;
        window.viewOrderDetails = viewOrderDetails;
        window.toggleUserDropdown = toggleUserDropdown;
        window.logout = logout;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.handleSearch = handleSearch;
        window.performSearch = performSearch;
        window.clearSearch = clearSearch;
        window.renderProfilePage = renderProfilePage;
        window.renderOrdersPage = renderOrdersPage;
        
        // Admin Fonksiyonları
        window.renderAdminPage = renderAdminPage;
        window.setAdminTab = setAdminTab;
        window.openProductModal = openProductModal;
        window.closeProductModal = closeProductModal;
        window.handleProductSubmit = handleProductSubmit;
        window.deleteProduct = deleteProduct;
        window.updateOrderStatus = updateOrderStatus;
        
        // Uygulamayı başlat
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
